<html>
	<head>
		<title>
			Welcome to sockchat.
		</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<style>
			body{
				margin:20px;
			}
			#postLogin{
				display: none;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>SockChat</h1>
			<div class="row" id="userFormArea">
				<div class="col-sm-12">
					<form id="userForm">
						<label for="user">Enter desired username:</label>
						<input name="user" id="uname" class="form-control" id="name" ><br>
						<input type="submit" class="btn btn-success" value="Login:">
					</form>
				</div>
			</div>
			<div class="row" id="postLogin">
				<div id="online" class="col-sm-3 well well-sm">
					<h3>Online users</h3>
					<ul class="list-group" id="onlineUsers">
					  
					</ul>
				</div>
				<div class="col-sm-8  jumbotron">
					<h2>Chat here!</h2>
					
					<ul id="chat">
						<div class="alert alert-info">
						  <strong>Server!</strong>Welcome to this chat room! You are now connected to the server!
						</div>
					</ul>

					<form id="messageForm">
						<textarea name="message" class="form-control" id="message" cols="50" rows="5"></textarea><br>
						<input type="submit" class="btn btn-success" value="send message">
					</form>
				</div>
			
			</div>
		</div>
		<script>
			$(function(){
				var socket = io.connect();
				var $msgform = $("#messageForm");
				var $message = $("#message");
				var $chat = $("#chat");
				var myuser ="";
				$("#userForm").submit(function (e) {
					e.preventDefault();
					myuser = $("#uname").val();
					socket.emit('new user',$("#uname").val(),function(data){
						if(data){
							$("#userFormArea").fadeOut();
							$("#postLogin").fadeIn();
						}
					});

					
				})
				socket.on('get users',function(data){
					var html = '';
					data.forEach(function(singleuser){
						html += '<li class="list-group-item">'+singleuser+'</li>';
					});
					$("#onlineUsers").html(html);
				});
				$msgform.submit(function(e){
					e.preventDefault();
					socket.emit('send message',$message.val());
					$message.val('');
				});
				$("#message").on('keyup', function (e) {
					console.log('dabaya');
				    if (e.keyCode == 13) {
				    	console.log('hmm');
				        $("#messageForm").submit();
				    }
				});
				socket.on('new message',function(data){
					if(data.user == myuser)
						$chat.append('<div class="alert alert-danger"><strong>'+data.user+':</strong> '+data.msg+'</div>');
					else
						$chat.append('<div class="alert alert-success"><strong>'+data.user+':</strong> '+data.msg+'</div>');
				});
			});
		</script>
	</body>
</html>